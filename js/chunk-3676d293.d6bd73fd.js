(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3676d293"],{"08ad":function(t,a,n){"use strict";n("fb05b")},aaf1:function(t,a,n){"use strict";n.r(a);n("b0c0"),n("9911");var i=function(){var t=this,a=t._self._c;return a("div",{staticClass:"m-jx3story-main",class:["m-".concat(t.key,"-main"),{isMiniProgram:t.isMiniProgram},{"m-vote-main-bg":t.hasVote}]},[a("el-aside",{staticClass:"m-left"},[a("div",{staticClass:"m-change"},[a("router-link",{attrs:{to:"/"}},[a("img",{attrs:{src:"".concat(t.cdn,"2025/web/logo.png"),alt:"",srcset:""}})]),a("div",{staticClass:"m-change-item",class:{active:t.changeYear},on:{click:function(a){t.changeYear=!t.changeYear}}},[a("span",{staticClass:"u-txt"},[t._v(t._s(t.year))]),a("ul",{directives:[{name:"show",rawName:"v-show",value:t.changeYear,expression:"changeYear"}],staticClass:"u-ul"},t._l(t.list,(function(n){return a("li",{key:n.year,on:{click:function(a){return a.stopPropagation(),t.onChange(n.year)}}},[t._v(t._s(n.year))])})),0)])],1),a("div",{staticClass:"m-tabs"},t._l(t.tabs,(function(n){return a("router-link",{key:n.name,staticClass:"u-router",class:[t.key==n.key?"active":""],attrs:{to:n.link}},[a("span",{staticClass:"u-txt"},[t._v(t._s(n.name))]),a("span",{staticClass:"u-mark"})])})),1)]),a("router-link",{staticClass:"m-top",attrs:{to:"/"}},[a("span",{staticClass:"u-back"})]),a("el-main",{staticClass:"m-main"},[a(t.components[t.key],{tag:"component",attrs:{data:t.componentData},on:{update:t.updateData}})],1)],1)},e=[],s=n("5530"),o=(n("99af"),n("4de4"),n("14d9"),n("e9f5"),n("910d"),n("d3b7"),n("85e4")),c=n("cc9a"),r=n("01ea"),l=function(){var t=this,a=t._self._c;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[t.content?a("div",{staticClass:"m-info-content"},[a("h1",{staticClass:"u-title"},[t._v(t._s(t.data.year)+"年茶馆风月录")]),a("div",{staticClass:"m-info",domProps:{innerHTML:t._s(t.content)}})]):t.loading?t._e():a("div",{staticClass:"u-null"},[a("img",{attrs:{src:t.data.nullImg}})])])},u=[],d=n("41cb");function m(t){return Object(d["a"])().get("/api/cms/post/".concat(t)).then((function(t){var a,n;return null===t||void 0===t||null===(a=t.data)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.post_content}))}var f={name:"jx3storyInfo",props:{data:{type:Object,default:function(){}}},data:function(){return{loading:!1,content:""}},computed:{ac_id:function(){return this.data.ac_id||""}},watch:{ac_id:{handler:function(t){this.content="",t&&this.loadInfo(t)},immediate:!0}},methods:{loadInfo:function(t){var a=this;this.loading=!0,m(t).then((function(t){a.content=t})).finally((function(){a.loading=!1}))}}},v=f,h=(n("f5a3"),n("2877")),p=Object(h["a"])(v,l,u,!1,null,null,null),g=p.exports,_=function(){var t=this,a=t._self._c;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-vote-content"},[t.list.length?[a("transition-group",{staticClass:"m-vote-list",attrs:{name:"fall",tag:"div"}},t._l(t.list,(function(n,i){return a("div",{key:n.id,staticClass:"m-vote-item",class:{falling:n.isFalling},style:{animationDelay:"".concat(n.fallDelay,"s"),swingDuration:"".concat(n.swingDuration,"s")},on:{animationend:function(a){return t.onFallEnd(i)}}},[a("div",{staticClass:"u-top",style:{paddingTop:n.padding}}),a("div",{staticClass:"u-vote"},[a("a",{staticClass:"u-title",attrs:{href:"".concat(t.root,"community/").concat(n.content),target:"_blank"}},[t._v(" "+t._s(n.title)+" ")])]),a("div",{staticClass:"u-bottom"})])})),0),a("div",{staticClass:"m-mini-box"},[a("div",{staticClass:"m-mini-list"},t._l(t.list,(function(n,i){return a("div",{key:i,staticClass:"m-item"},[a("a",{staticClass:"m-info",attrs:{href:"".concat(t.root,"community/").concat(n.content),target:"_blank"}},[a("span",{staticClass:"u-title"},[t._v(" "+t._s(n.title)+" ")]),a("span",{staticClass:"u-author"},[t._v(" —— "+t._s(n.user_info.display_name)+" ")])]),a("div",{staticClass:"u-vote",class:{active:n.active},on:{click:function(a){return a.stopPropagation(),t.handleVote(n)}}},[t._v(" "+t._s(n.active?"已投票":"投TA一票")+" ")])])})),0)])]:t.loading?t._e():a("div",{staticClass:"u-null"},[a("img",{attrs:{src:t.data.nullImg}})])],2)},b=[],y=n("c14f"),C=n("1da1"),j=(n("d81d"),n("ab43"),n("fc22")),k=n("2ef0"),w={name:"jx3storyVote",props:{data:{type:Object,default:function(){}}},data:function(){return{loading:!1,list:[],cdn:r["d"],root:r["c"]}},computed:{vote_id:function(){return this.data.vote_id||""}},watch:{vote_id:{handler:function(t){this.list=[],this.$emit("update",{hasVote:!1}),t&&this.loadVote(t)},immediate:!0}},methods:{loadVote:function(t){var a=this;this.loading=!0,Object(j["b"])(t).then(function(){var t=Object(C["a"])(Object(y["a"])().m((function t(n){var i,e,o;return Object(y["a"])().w((function(t){while(1)switch(t.n){case 0:o=Object(k["shuffle"])((null===(i=n.data)||void 0===i||null===(e=i.data)||void 0===e?void 0:e.vote_items)||[]),a.list=o.map((function(t,a){var n=Math.floor(220*Math.random());return t.fallDelay=.2*a,t.isFalling=!1,Object(s["a"])(Object(s["a"])({},t),{},{padding:"".concat(n,"px")})})),a.$emit("update",{hasVote:o.length});case 1:return t.a(2)}}),t)})));return function(a){return t.apply(this,arguments)}}()).finally((function(){a.loading=!1}))},onFallEnd:function(t){this.list[t].isFalling=!0}}},O=w,x=Object(h["a"])(O,_,b,!1,null,null,null),V=x.exports,D=function(){var t=this,a=t._self._c;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-stats-content",class:t.list.length?"":"noPadding"},[t.list.length?a("div",{staticClass:"m-list-box"},[a("div",{staticClass:"m-list-header"},[a("span",{staticClass:"u-title"},[t._v(t._s(t.data.year)+"年茶馆风月录作品投票")])]),a("div",{staticClass:"m-list"},[t._m(0),t.isMiniProgram?a("div",{staticClass:"m-mini-scroll"},t._l(t.list,(function(n,i){return a("div",{key:i,staticClass:"m-list-item"},[a("div",{staticClass:"u-info"},[a("span",{staticClass:"u-post"},[a("a",{attrs:{href:"".concat(t.root,"community/").concat(n.content),target:"_blank"}},[t._v(t._s(n.title))])]),a("span",{staticClass:"u-author"},[a("a",{attrs:{href:"".concat(t.root,"author/").concat(n.user_info.id),target:"_blank"}},[t._v(" —— "+t._s(n.user_info.display_name)+" ")])])]),a("span",{staticClass:"u-number"},[t._v(t._s(n.amount))])])})),0):t._l(t.list,(function(n,i){return a("div",{key:i,staticClass:"m-list-item"},[a("span",{staticClass:"u-number"},[a("span",{staticClass:"u-amount"},[t._v(t._s(i+1))])]),a("span",{staticClass:"u-post"},[a("a",{attrs:{href:"".concat(t.root,"community/").concat(n.content),target:"_blank"}},[t._v(t._s(n.title))])]),a("span",{staticClass:"u-author"},[a("a",{attrs:{href:"".concat(t.root,"author/").concat(n.user_info.id),target:"_blank"}},[t._v(" "+t._s(n.user_info.display_name)+" ")])]),a("span",{staticClass:"u-number",on:{click:function(a){return a.stopPropagation(),t.handleVote(n)}}},[a("span",{staticClass:"u-amount"},[t._v(t._s(n.amount))]),t.endVote?t._e():a("img",{staticClass:"u-vote",attrs:{src:"".concat(t.cdn,"2025/web/").concat(n.active?"active":"vote",".png")}})])])}))],2)]):t.loading?t._e():a("div",{staticClass:"u-null"},[a("img",{attrs:{src:t.cdn+"2025/web/null.png"}})])])},M=[function(){var t=this,a=t._self._c;return a("div",{staticClass:"m-list-item m-list-item-header"},[a("span",{staticClass:"u-number endVote"},[t._v("序号")]),a("span",{staticClass:"u-post"},[t._v(" 入选作品")]),a("span",{staticClass:"u-author"},[t._v("作者")]),a("span",{staticClass:"u-number"},[t._v("票数")])])}],P=(n("caad"),n("4e82"),n("2532"),n("c9d2")),T={name:"jx3storyStats",props:{data:{type:Object,default:function(){}}},data:function(){return{isLogin:P["a"].isLogin(),loading:!1,list:[],root:r["c"],isMiniProgram:Object(o["j"])(),cdn:r["d"]+"design/event/jx3story/",lastVoteTime:0,end_at:0}},computed:{vote_id:function(){return this.data.vote_id||""},endVote:function(){var t=(new Date).getTime();return new Date(this.end_at).getTime()<t}},watch:{vote_id:{handler:function(t){this.list=[],t&&this.loadVote(t)},immediate:!0}},methods:{loadVote:function(t){var a=this;this.loading=!0,Object(j["b"])(t).then(function(){var n=Object(C["a"])(Object(y["a"])().m((function n(i){var e,s,o,c,r,l;return Object(y["a"])().w((function(n){while(1)switch(n.n){case 0:if(a.end_at=(null===(e=i.data)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.end_at)||0,r=Object(k["shuffle"])((null===(o=i.data)||void 0===o||null===(c=o.data)||void 0===c?void 0:c.vote_items)||[]),a.list=r.sort((function(t,a){return a.amount-t.amount})),l=a.isLogin,!l){n.n=1;break}return n.n=1,a.loadMyVote(t);case 1:return n.a(2)}}),n)})));return function(t){return n.apply(this,arguments)}}()).finally((function(){a.loading=!1}))},loadMyVote:function(t){var a=this;return Object(C["a"])(Object(y["a"])().m((function n(){var i,e,o,c,r;return Object(y["a"])().w((function(n){while(1)switch(n.n){case 0:return n.n=1,Object(j["a"])(t);case 1:o=n.v,c=(null===(i=o.data)||void 0===i||null===(e=i.data)||void 0===e?void 0:e.list)||[],r=c.map((function(t){return t.vote_item_id})),a.list=a.list.map((function(t){return Object(s["a"])(Object(s["a"])({},t),{},{active:r.includes(t.id)})}));case 2:return n.a(2)}}),n)})))()},handleVote:function(t){var a=this;if(!t.active)if(this.isLogin){var n=1e3,i=Date.now();if(i-this.lastVoteTime<n)return this.$message({message:"投票速度太快啦！",type:"warning"});this.lastVoteTime=i,Object(j["f"])(t.program_id,{vote_id_list:[t.id]}).then((function(){a.$message({message:"投票成功",type:"success"}),t.active=!0}))}else P["a"].toLogin()}}},q=T,Y=Object(h["a"])(q,D,M,!1,null,null,null),$=Y.exports,I={name:"jx3storyMain",inject:["__imgRoot"],data:function(){return{list:[],hasVote:!1,year:"2025",changeYear:!1,isMiniProgram:Object(o["j"])(),cdn:r["d"]+"design/event/jx3story/",tabs:[{name:"活动介绍",key:"info",link:{path:"/detail",query:{key:"info"}}},{name:"入选作品",key:"vote",link:{path:"/detail",query:{key:"vote"}}},{name:"参与投票",key:"stats",link:{path:"/detail",query:{key:"stats"}}}],components:{info:g,vote:V,stats:$}}},computed:{key:function(){return this.$route.query.key||"info"},componentData:function(){var t=this,a=this.list.filter((function(a){return a.year==t.year}))[0]||{},n=this.isMiniProgram?"mini":"web";return Object(s["a"])(Object(s["a"])({},a),{},{nullImg:"".concat(r["d"],"/design/event/jx3story/2025/").concat(n,"/null.png?").concat(Date.now())})}},watch:{year:function(t,a){this.$router.push({path:"/detail",query:{key:this.key,year:t}})}},mounted:function(){var t=this.$route.query.year||"2025";this.year=t,this.load()},methods:{load:function(){var t=this;Object(c["d"])("jx3story_data").then((function(a){t.list=a}))},onChange:function(t){this.year=t,this.changeYear=!1},updateData:function(t){var a=t||{},n=a.hasVote;this.hasVote=n||!1}}},L=I,F=(n("08ad"),Object(h["a"])(L,i,e,!1,null,null,null));a["default"]=F.exports},cd46:function(t,a,n){},f5a3:function(t,a,n){"use strict";n("cd46")},fb05b:function(t,a,n){},fc22:function(t,a,n){"use strict";n.d(a,"b",(function(){return e})),n.d(a,"c",(function(){return s})),n.d(a,"a",(function(){return o})),n.d(a,"f",(function(){return c})),n.d(a,"d",(function(){return r})),n.d(a,"e",(function(){return l}));n("99af");var i=n("41cb");function e(t){return Object(i["c"])().get("/api/next2/vote-program/program/".concat(t,"/public"))}function s(t,a){return Object(i["c"])().get("/api/next2/vote-program/program/".concat(t,"/public/vote-item/").concat(a))}function o(t){return Object(i["c"])().get("/api/next2/vote-program/program/".concat(t,"/my-vote-history"))}function c(t,a){return Object(i["c"])().post("/api/next2/vote-program/program/".concat(t,"/vote"),a)}function r(t,a){return Object(i["a"])().get("/api/cms/vote/program/item/".concat(t,"/qrcode"),{params:a})}function l(){return Object(i["a"])().get("/api/cms/manage/www/block/load",{params:{slug:"mid_autumn_2024",app:"std"}}).then((function(t){return t.data.data.items}))}}}]);