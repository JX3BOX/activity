(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e92d763e"],{"224b":function(t,e,n){"use strict";n("dce1")},3835:function(t,e,n){"use strict";function a(t){if(Array.isArray(t))return t}n.d(e,"a",(function(){return c}));n("a4d3"),n("e01a"),n("d28b"),n("14d9"),n("d3b7"),n("3ca3"),n("ddb0");function r(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var a,r,s,i,c=[],o=!0,l=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;o=!1}else for(;!(o=(a=s.call(n)).done)&&(c.push(a.value),c.length!==e);o=!0);}catch(t){l=!0,r=t}finally{try{if(!o&&null!=n["return"]&&(i=n["return"](),Object(i)!==i))return}finally{if(l)throw r}}return c}}var s=n("06c5");n("d9e2");function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t,e){return a(t)||r(t,e)||Object(s["a"])(t,e)||i()}},9423:function(t,e,n){"use strict";n.r(e);n("99af"),n("b0c0");var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"p-lover-card",style:t.containerStyle},[e("div",{staticClass:"m-container"},[e("div",{staticClass:"m-top-section"},[e("div",{staticClass:"m-header"},[e("div",{staticClass:"m-title"},[e("img",{staticClass:"u-title-img",attrs:{src:"".concat(t.cdnLink,"design/event/lover/title.png"),alt:"title"}}),t._m(0)]),e("div",{staticClass:"m-cards-info"},[e("div",{staticClass:"u-title"},[t._v("天命签效果说明")]),e("div",{staticClass:"u-list"},t._l(t.cards,(function(n,a){return e("div",{key:a,staticClass:"u-list-item"},[e("span",{staticClass:"u-list-item-name"},[t._v(t._s(n.name))]),e("span",[t._v("-")]),e("span",{staticClass:"u-list-item-desc"},[t._v(t._s(n.desc))])])})),0)])]),e("div",{staticClass:"m-cards"},[e("video",{staticClass:"u-result-fire",attrs:{autoplay:"",disablepictureinpicture:"",disableremoteplayback:"",loop:"",muted:"",playsinline:"",src:"".concat(t.cdnLink,"design/event/lover/fire.webm")},domProps:{muted:!0}}),t._l(t.renderCards,(function(n,a){return e("div",{key:a,ref:"cardRef",refInFor:!0,staticClass:"u-card",style:t.cardStyle(a)},[e("div",{staticClass:"u-card-flipper",class:{"is-center":a===Math.floor(t.cards.length/2)}},[e("img",{staticClass:"u-card-cover",attrs:{src:n.img,alt:""}}),e("img",{staticClass:"u-card-back",attrs:{src:t.cardBackImg,alt:""}})])])}))],2)]),e("div",{staticClass:"m-actions-section"},[e("div",{staticClass:"m-select"},[e("el-select",{staticClass:"u-select u-select-event",attrs:{placeholder:"选择活动","popper-class":"m-card-select-popper",disabled:t.onDrawing||t.enableResultAnimation},on:{change:t.onSelectEvent},model:{value:t.slug,callback:function(e){t.slug=e},expression:"slug"}},t._l(t.$store.state.events,(function(t){return e("el-option",{key:t.slug,attrs:{label:t.name,value:t.slug}})})),1),e("el-select",{staticClass:"u-select u-select-process",attrs:{placeholder:"选择赛程","popper-class":"m-card-select-popper",disabled:t.onDrawing||t.enableResultAnimation},model:{value:t.currentProcessId,callback:function(e){t.currentProcessId=e},expression:"currentProcessId"}},t._l(t.processes,(function(t){return e("el-option",{key:t.id,attrs:{label:"第 ".concat(t.round," 轮 - 第 ").concat(t.position," 场"),value:t.id}})})),1),e("el-select",{staticClass:"u-select u-select-team",attrs:{placeholder:"选择队伍","popper-class":"m-card-select-popper",disabled:t.onDrawing||t.enableResultAnimation},model:{value:t.currentTeamId,callback:function(e){t.currentTeamId=e},expression:"currentTeamId"}},t._l(t.teamOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.team_name,value:t.id}})})),1)],1),e("div",{staticClass:"u-draw-button",on:{click:t.onDraw}}),e("div",{staticClass:"u-confirm-button",class:{"is-ready":t.currentCard},on:{click:t.onSetCard}},[t.currentCard?e("div",{staticClass:"u-draw-result"},[e("span",[t._v("本次抽得：")]),e("span",{staticClass:"u-draw-result-name"},[t._v(t._s(t.currentCard.name))])]):t._e(),t.currentCard?e("span",[t._v("提交结果")]):e("span",[t._v("未出结果")])])])])])},r=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-subtitle"},[e("div",{staticClass:"u-line"},[e("span",{staticClass:"u-line-title"},[t._v("裁判")]),e("span",{staticClass:"u-line-content"},[t._v("组织抽取“同心天命签”并公布结果")])]),e("div",{staticClass:"u-line"},[e("span",{staticClass:"u-line-title"},[t._v("选手")]),e("span",{staticClass:"u-line-content"},[t._v("根据抽签结果调整配装与奇穴，锁定配置")])])])}],s=n("ade3"),i=n("c14f"),c=n("1da1"),o=n("3835"),l=n("2909"),u=(n("4de4"),n("7db0"),n("c740"),n("14d9"),n("a434"),n("e9f5"),n("f665"),n("d3b7"),n("3ca3"),n("ddb0"),n("65c2")),d=n("ead5"),f={name:"",components:{},props:{},data:function(){return{cdnLink:u["__cdn"],slug:null,cardBackImg:"".concat(u["__cdn"],"design/event/lover/q0.png"),cards:[],processes:[],currentProcessId:null,currentTeamId:null,currentCard:null,onDrawing:!1,animationPlaying:!1,enableFlipperAnimation:!0,cardRotateDeg:0,enableMoveAnimation:!1,cardMoveDistance:[],enableResultAnimation:!1}},computed:{events:function(){return this.$store.state.events},currentEvent:function(){return this.$store.state.event},containerStyle:function(){var t={"--background-image":"url(".concat(u["__cdn"],"design/event/lover/bg.webp)"),"--draw-image":"url(".concat(u["__cdn"],"design/event/lover/open0.png)"),"--draw-image-hover":"url(".concat(u["__cdn"],"design/event/lover/open1.png)")};return this.enableFlipperAnimation&&(t["--card-flipper-transition"]="transform 0.5s"),this.enableMoveAnimation&&(t["--card-move-transition"]="transform 0.5s"),this.enableResultAnimation&&(t["--card-flipper-transition"]="transform 0.5s",t["--card-center-transform"]="rotateY(180deg) scale(1.04)",t["--file-opacity"]=1),t["--card-transform"]="rotateY(".concat(this.cardRotateDeg,"deg)"),t},renderCards:function(){var t=this,e=Object(l["a"])(this.cards);if(this.currentCard){var n=e.findIndex((function(e){return e.id===t.currentCard.id}));if(-1!==n){var a=e.splice(n,1),r=Object(o["a"])(a,1),s=r[0];e.splice(Math.floor(e.length/2),0,s)}}return e},currentProcess:function(){var t=this;return this.processes.find((function(e){return e.id===t.currentProcessId}))||null},teamOptions:function(){return this.currentProcess?[this.currentProcess.team1_record,this.currentProcess.team2_record].filter(Boolean):[]}},watch:{"$route.params.slug":{immediate:!0,handler:function(t){this.slug=t}},"currentEvent.id":{immediate:!0,deep:!0,handler:function(){this.loadCards(),this.loadProcessList()}}},methods:{onDraw:function(){var t=this;return Object(c["a"])(Object(i["a"])().m((function e(){var n,a,r;return Object(i["a"])().w((function(e){while(1)switch(e.n){case 0:if(!t.onDrawing&&!t.animationPlaying){e.n=1;break}return e.a(2);case 1:if(t.currentProcessId&&t.currentTeamId){e.n=2;break}return t.$message.error("请先选择赛程和队伍"),e.a(2);case 2:return t.onDrawing=!0,t.currentCard=null,e.n=3,Promise.all([t.loadDrawResult(),t.playAnimation()]);case 3:if(n=e.v,a=Object(o["a"])(n,1),r=a[0],r){e.n=4;break}return e.a(2);case 4:t.currentCard=r,t.onDrawing=!1;case 5:return e.a(2)}}),e)})))()},playAnimation:function(){var t=this;return Object(c["a"])(Object(i["a"])().m((function e(){var n;return Object(i["a"])().w((function(e){while(1)switch(e.n){case 0:if(!t.animationPlaying){e.n=1;break}return e.a(2);case 1:return t.resetAnimation(),t.animationPlaying=!0,t.enableFlipperAnimation=!0,t.cardRotateDeg=180,e.n=2,new Promise((function(t){return setTimeout(t,1e3)}));case 2:return t.cardRotateDeg=360,e.n=3,new Promise((function(t){return setTimeout(t,1e3)}));case 3:t.enableFlipperAnimation=!1,t.cardRotateDeg=0,t.enableMoveAnimation=!0,n=0;case 4:if(!(n<4)){e.n=6;break}return t.doShuffle(),e.n=5,new Promise((function(t){return setTimeout(t,500)}));case 5:n++,e.n=4;break;case 6:t.enableMoveAnimation=!1,t.$set(t,"cardMoveDistance",[]),t.enableResultAnimation=!0,t.animationPlaying=!1;case 7:return e.a(2)}}),e)})))()},doShuffle:function(){if(this.cardMoveDistance.length)this.$set(this,"cardMoveDistance",[]);else for(var t=this.$refs.cardRef,e=0;e<t.length/2;e++){var n=t[e],a=t[t.length-1-e],r=a.offsetLeft-n.offsetLeft,s=n.offsetLeft-a.offsetLeft;this.$set(this.cardMoveDistance,e,r),this.$set(this.cardMoveDistance,t.length-1-e,s)}},reset:function(){this.resetAnimation(),this.currentCard=null},resetAnimation:function(){this.enableResultAnimation=!1,this.animationPlaying=!1,this.cardRotateDeg=0,this.$set(this,"cardMoveDistance",[])},cardStyle:function(t){return this.enableMoveAnimation?{transform:"translateX(".concat(this.cardMoveDistance[t]||0,"px)")}:this.enableResultAnimation&&t===Math.floor(this.cards.length/2)?{transform:"scale(1.2)",transition:"transform 0.5s"}:this.currentCard&&t===Math.floor(this.cards.length/2)?void 0:{transition:"all 0.5s"}},loadCards:function(){var t=this;Object(d["c"])({_no_page:1,event_id:this.currentEvent.id}).then((function(e){t.cards=e.data.data.list||[]}))},loadProcessList:function(){var t=this;Object(d["k"])({_no_page:1,event_id:this.currentEvent.id}).then((function(e){t.processes=e.data.data.list||[],console.log(Object(l["a"])(t.processes))})).catch((function(e){console.error("获取流程列表失败:",e),t.$message.error("获取流程列表失败，请稍后再试")}))},loadDrawResult:function(){var t=this;return Object(c["a"])(Object(i["a"])().m((function e(){return Object(i["a"])().w((function(e){while(1)switch(e.n){case 0:return e.a(2,Object(d["p"])(t.currentEvent.id,190).then((function(t){return t.data.data})).catch((function(e){console.error("抽签请求失败:",e),t.$message.error("抽签请求失败，请稍后再试")})))}}),e)})))()},onSelectEvent:function(t){t!=this.slug&&this.$router.push({name:"card",params:{slug:t}})},onSetCard:function(){var t=this;this.currentCard&&this.$confirm("是否将卡片 ".concat(this.currentCard.name," 设置为当前队伍的天命签？"),"确认").then((function(){var e=t.currentProcess.team1_record.id===t.currentTeamId?"team1_card":"team2_card";Object(d["q"])(t.currentProcessId,Object(s["a"])({},e,t.currentCard.id)).then((function(){t.$message.success("设置卡片成功"),t.loadProcessList()}))})).catch((function(){})).finally((function(){t.reset()}))}}},m=f,v=(n("224b"),n("2877")),p=Object(v["a"])(m,a,r,!1,null,null,null);e["default"]=p.exports},c740:function(t,e,n){"use strict";var a=n("23e7"),r=n("b727").findIndex,s=n("44d2"),i="findIndex",c=!0;i in[]&&Array(1)[i]((function(){c=!1})),a({target:"Array",proto:!0,forced:c},{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),s(i)},dce1:function(t,e,n){}}]);