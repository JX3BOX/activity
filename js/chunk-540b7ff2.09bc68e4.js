(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-540b7ff2"],{"12d4":function(t){t.exports=JSON.parse('["蝶恋花","龙争虎斗","长安城","幽月轮","斗转星移","剑胆琴心","乾坤一掷","唯我独尊","梦江南","绝代天骄","天鹅坪","破阵子","飞龙在天","眉间雪","山海相逢","傲血戰意","山海相逢","眉间雪"]')},"13d5":function(t,e,i){"use strict";var s=i("23e7"),a=i("d58f").left,o=i("a640"),n=i("1212"),r=i("9adc"),l=!r&&n>79&&n<83,c=l||!o("reduce");s({target:"Array",proto:!0,forced:c},{reduce:function(t){var e=arguments.length;return a(this,t,e,e>1?arguments[1]:void 0)}})},"14d5":function(t,e,i){"use strict";i("1e49")},"1e49":function(t,e,i){},"40a4":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-lover-join wp"},[e("div",{staticClass:"m-page-title"},[e("img",{staticClass:"u-join-img",attrs:{src:"".concat(t.__imgRoot,"join-title.png")}})]),t.isLogin?[t.joined?[e("div",{staticClass:"m-success"},[-1!=t.joinRecord.status?e("img",{staticClass:"u-success-img",attrs:{src:"".concat(t.__imgRoot,"join-success.png")}}):t._e(),e("div",{staticClass:"u-join-notice",domProps:{innerHTML:t._s(t.notice)}})]),2==t.joinRecord.status||1==t.joinRecord.status||-2==t.joinRecord.status?e("div",{staticClass:"m-team-box"},[e("div",{staticClass:"m-team-info"},[e("div",{staticClass:"m-team-info__left"},[e("img",{staticClass:"u-team-logo",attrs:{src:t.joinRecord.images[0],alt:""}}),e("div",{staticClass:"u-team-slogan"},[t._v(t._s(t.joinRecord.slogan))])]),e("div",{staticClass:"m-team-info__right"},[e("div",{staticClass:"m-info-item u-team-name"},[e("span",{staticClass:"u-label"},[t._v("队伍名")]),e("span",{staticClass:"u-value"},[t._v(t._s(t.joinRecord.team_name))])]),t._l(t.uniqBy(t.joinRecord.teammeta_user_list,"id"),(function(i){return[e("div",{key:i.id,staticClass:"m-info-item u-team-member"},[e("span",{staticClass:"u-label"},[t._v("角色名")]),e("span",{staticClass:"u-value"},[e("el-image",{staticClass:"u-avatar",attrs:{src:t.showAvatar(i.avatar)}}),t._v(" "+t._s(i.display_name)+" ")],1)])]})),e("div",{staticClass:"m-info-item u-server"},[e("span",{staticClass:"u-label"},[t._v("服务器")]),e("span",{staticClass:"u-value"},[t._v(t._s(t.joinRecord.server))])]),e("div",{staticClass:"m-info-item u-live"},[e("span",{staticClass:"u-label"},[t._v("直播信息")]),t.joinRecord.live_platform&&t.joinRecord.live_url?e("span",{staticClass:"u-value"},[t._v(" "+t._s(t.joinRecord.live_platform)+": "+t._s(t.joinRecord.live_url)+" ")]):e("span",{staticClass:"u-value"},[t._v(" - ")])]),e("div",{staticClass:"m-info-item u-qq"},[e("span",{staticClass:"u-label"},[t._v("联系QQ")]),e("span",{staticClass:"u-value"},[t._v(t._s(t.joinRecord.qq))])]),e("div",{staticClass:"m-info-item u-phone"},[e("span",{staticClass:"u-label"},[t._v("联系电话")]),e("span",{staticClass:"u-value"},[t._v(t._s(t.joinRecord.phone))])])],2)])]):t._e()]:[t.loverHasBind?t._e():e("div",{staticClass:"m-join-bind"},[e("a",{staticClass:"u-bind-btn",attrs:{target:"_blank",href:"/dashboard/privacy?tab=lover"}})])],t.loverHasBind&&!t.joined||t.joined&&-1==t.joinRecord.status||0==t.joinRecord.status?e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-join-form"},[e("el-form",{ref:"form",class:["m-lover-form"],attrs:{disabled:t.formDisabled,model:t.form,rules:t.rules,"label-width":"80px"}},[e("el-row",{attrs:{gutter:10}},t._l(t.uniqBy(t.loverNet.members,"id"),(function(i,s){return e("el-col",{key:i.id,attrs:{span:12}},[e("el-form-item",{attrs:{label:"队员".concat(s+1)}},[e("div",{staticClass:"m-role"},[e("el-image",{staticClass:"u-avatar",attrs:{src:t.showAvatar(i.user_info.avatar)}}),t._v(" "+t._s(i.user_info.display_name)+" ")],1)])],1)})),1),e("el-row",{attrs:{gutter:10}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"队伍名称",prop:"team_name"}},[e("el-input",{attrs:{placeholder:"请输入队伍名"},model:{value:t.form.team_name,callback:function(e){t.$set(t.form,"team_name",e)},expression:"form.team_name"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"服务器",prop:"server"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择服务器"},model:{value:t.form.server,callback:function(e){t.$set(t.form,"server",e)},expression:"form.server"}},t._l(t.serverOptions,(function(i,s){return e("el-option",{key:s,attrs:{label:i.label,value:i.value}},[t._v(" "+t._s(i.label)+" ")])})),1)],1)],1)],1),e("el-row",{attrs:{gutter:10}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"联系QQ",prop:"qq"}},[e("el-input",{model:{value:t.form.qq,callback:function(e){t.$set(t.form,"qq",e)},expression:"form.qq"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"联系电话",prop:"phone"}},[e("el-input",{model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1)],1)],1),e("el-form-item",{attrs:{label:"直播信息",prop:"live_id"}},[e("div",{staticClass:"u-live-form"},[e("el-select",{attrs:{"allow-create":"","default-first-option":"",filterable:"",placeholder:"直播平台"},model:{value:t.form.live_platform,callback:function(e){t.$set(t.form,"live_platform",e)},expression:"form.live_platform"}},[e("el-option",{attrs:{label:"斗鱼",value:"douyu"}}),e("el-option",{attrs:{label:"虎牙",value:"huya"}}),e("el-option",{attrs:{label:"B站",value:"bilibili"}}),e("el-option",{attrs:{label:"抖音",value:"douyin"}})],1),e("el-input",{attrs:{placeholder:"直播间地址"},model:{value:t.form.live_url,callback:function(e){t.$set(t.form,"live_url",e)},expression:"form.live_url"}})],1)]),e("el-form-item",{attrs:{label:"参赛宣言",prop:"slogan"}},[e("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入参赛宣言(最多30字)"},model:{value:t.form.slogan,callback:function(e){t.$set(t.form,"slogan",e)},expression:"form.slogan"}})],1),e("el-form-item",{attrs:{label:"合照",prop:"images"}},[t.joined&&t.joinRecord.images.length?e("div",{staticClass:"u-image-list"},t._l(t.form.images,(function(t,i){return e("img",{key:i,staticClass:"u-image-item",attrs:{src:t}})})),0):e("uploadImage",{ref:"upload-image",on:{onFinish:t.onImageUploaded}})],1)],1),e("div",{class:["u-submit",{disabled:t.formDisabled}],on:{click:t.startUploadImage}},[e("img",{staticClass:"u-submit-img",attrs:{src:"".concat(t.__imgRoot,"join-btn.png")}})])],1):t._e()]:e("div",{staticClass:"m-join-bind"},[e("a",{staticClass:"u-bind-btn",attrs:{target:"_blank",href:"/dashboard/privacy?tab=lover"}})])],2)},a=[],o=i("5530"),n=(i("d9e2"),i("4de4"),i("d81d"),i("e9f5"),i("910d"),i("ab43"),i("d3b7"),i("ac1f"),i("00b4"),i("12d4")),r=i("c9d2"),l=i("ead5"),c=i("85e4"),u=(i("a15b"),i("13d5"),i("9485"),function(){var t=this,e=t._self._c;return e("div",[e("el-upload",{ref:"upload",attrs:{action:"https://cms.jx3box.com/api/cms/upload","list-type":"picture-card","on-preview":t.handlePictureCardPreview,"auto-upload":!1,"file-list":t.fileList,limit:t.maxCount,accept:t.acceptedExtensions.reduce((function(t,e){return t+".".concat(e,",")}),""),multiple:"","with-credentials":"","on-exceed":t.onExceed,"on-change":t.onChange,"on-success":t.onSuccess,"on-error":t.onError}},[e("i",{staticClass:"el-icon-plus"}),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(" 最多上传 "+t._s(t.maxCount)+" 张 "+t._s(t.acceptedExtensions.join(" / ").toUpperCase())+" 格式图片，单张图片不能超过 "+t._s(t.maxSize/1024/1024)+" MB ")])]),e("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("img",{attrs:{width:"60%",src:t.dialogImageUrl,alt:""}})])],1)}),d=[],m=(i("99af"),i("a9e3"),{props:{fileMaxSize:{type:Number,default:10}},data:function(){return{dialogImageUrl:"",dialogVisible:!1,fileList:[],successList:[],acceptedExtensions:["jpg","jpeg","png","gif"],maxCount:5,maxSize:1024*this.fileMaxSize*1024}},methods:{handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},onExceed:function(){this.$notify({title:"",message:"最多上传 ".concat(this.maxCount," 张图片！"),type:"error",duration:3e3,position:"bottom-right"})},onChange:function(t,e){"ready"==t.status&&(t.size>this.maxSize?(this.$notify({title:"",message:"单张图片大小不能超过 ".concat(this.maxSize/1024/1024," MB！"),type:"error",duration:3e3,position:"bottom-right"}),e.pop()):this.fileList=e)},upload:function(){this.fileList.length>0?this.$refs.upload.submit():this.$emit("onFinish",[])},onSuccess:function(t){this.successList=this.successList.concat(t.data),0===t.code?this.successList.length==this.fileList.length&&(this.$emit("onFinish",this.successList||[]),this.fileList=[],this.successList=[]):this.onError(t.msg)},onError:function(){this.$notify({title:"",message:"图片上传失败!",type:"error",duration:3e3,position:"bottom-right"}),this.$emit("onError"),this.fileList=[]},addFile:function(t){return this.$refs.upload.handleStart(t),!1}}}),f=m,v=i("2877"),p=Object(v["a"])(f,u,d,!1,null,null,null),h=p.exports,g=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-certificate"},[e("h3",{staticClass:"u-title"},[t._v("情缘证")]),e("div",{staticClass:"m-lover-users"},t._l(t.data.members,(function(i){return e("div",{key:i.id,staticClass:"m-lover-user"},[e("img",{staticClass:"u-avatar",attrs:{src:i.user_info.avatar||t.defaultAvatar}}),e("div",{staticClass:"u-name"},[t._v(t._s(i.user_info.display_name))])])})),0),e("h3",{staticClass:"u-days"},[t._v("结缘于 "+t._s(t.dayCount)+" 天前")])])},_=[],b=i("5a0c"),j=i.n(b),C={name:"certificate",props:{data:{type:Object,default:function(){}}},data:function(){return{}},computed:{defaultAvatar:function(){return"https://cdn.jx3box.com/image/common/avatar.png"},dayCount:function(){var t=this.data.members.reduce((function(t,e){var i=j()(e.created_at);return i.isAfter(t)?i:t}),j()(0));return-1*t.diff(j()(),"day")}},methods:{},mounted:function(){}},y=C,R=(i("14d5"),Object(v["a"])(y,g,_,!1,null,null,null)),w=(R.exports,i("2ef0")),x=i("f1d2"),q=i("cc9a"),$={name:"LoverJoin",inject:["__imgRoot"],components:{uploadImage:h},data:function(){var t=this;return{loading:!1,list:[],form:{team_name:"",slogan:"",images:[],server:"",qq:"",phone:"",live_platform:"",live_url:""},rules:{team_name:[{required:!0,trigger:"blur",validator:function(t,e,i){e.length>7?i(new Error("队伍名不能超过7字")):0===e.length?i(new Error("请输入队伍名")):/^[\u4e00-\u9fa5]+$/.test(e)?i():i(new Error("队伍名只能包含中文"))}}],server:[{required:!0,message:"请选择服务器",trigger:"change"}],qq:[{required:!0,message:"请输入联系QQ",trigger:"blur"}],phone:[{required:!0,message:"请输入联系电话",trigger:"blur"}],slogan:[{required:!0,message:"请输入参赛宣言",trigger:"blur"}],images:[{required:!0,message:"请上传合照",trigger:"blur",validator:function(e,i,s){var a;0===(null===(a=t.$refs["upload-image"])||void 0===a?void 0:a.fileList.length)?s(new Error("请上传合照")):(t.form.images.length&&s(),s())}}]},join_loading:!1,origin_notice:""}},computed:{serverOptions:function(){return n.map((function(t){return{value:t,label:t}}))},eventId:function(){return this.$store.getters.currentEventId},isLogin:function(){return r["a"].isLogin()},loverNet:function(){return this.$store.state.lover_net},loverHasBind:function(){var t,e,i;return this.loverNet&&(null===(t=this.loverNet)||void 0===t||null===(e=t.members)||void 0===e||null===(i=e.filter((function(t){return 1===t.status})))||void 0===i?void 0:i.length)>1},joinRecord:function(){return this.$store.state.join_record},joined:function(){return Boolean(this.joinRecord)},systemJoinParams:function(){return{event_id:this.eventId,user_id:r["a"].profile.ID,status:0,team_mates:this.loverNet.members.map((function(t){return t.user_id})),relation_net_id:this.loverNet.net.id,remark:null}},notice:function(){return this.event_notice||this.origin_notice},event_notice:function(){var t,e=null===(t=this.joinRecord)||void 0===t?void 0:t.status;return 0===e?"⏳ 报名已提交，请等待审核！":-1==e?"⚠️ 申请未通过，请重新提交信息</br>Reason：".concat(this.joinRecord.comment):-2==e?"❌ 报名已取消或淘汰！":""},formDisabled:function(){return this.joined&&0==this.joinRecord.status}},methods:{uniqBy:w["uniqBy"],authorLink:c["a"],showAvatar:c["n"],toLogin:function(){r["a"].toLogin()},startUploadImage:function(){var t=this;this.joined&&-1!=this.joinRecord.status||this.$refs["form"].validate((function(e){if(!e)return t.join_loading=!1,!1;var i=t.$refs["upload-image"];t.join_loading=!0,t.form.images.length?t.toJoin():i.upload()}))},onImageUploaded:function(t){console.log("图片上传成功",t),this.form.images=t,this.toJoin()},toJoin:function(){var t=this,e=Object(o["a"])(Object(o["a"])({},this.systemJoinParams),this.form);this.joined?Object(x["c"])(this.eventId,this.joinRecord.id,e).then((function(){t.$notify({title:"更新成功",type:"success"}),t.$router.go(0)})).finally((function(){t.join_loading=!1})):Object(l["o"])(this.eventId,e).then((function(){t.$notify({title:"报名成功",type:"success"}),t.$router.go(0)})).finally((function(){t.join_loading=!1}))},initJoinForm:function(){var t=this;this.isLogin&&(this.joined?(this.form.team_name=this.joinRecord.team_name,this.form.slogan=this.joinRecord.slogan,this.form.images=this.joinRecord.images||[],this.form.server=this.joinRecord.server,this.form.qq=this.joinRecord.qq,this.form.phone=this.joinRecord.phone,this.form.live_platform=this.joinRecord.live_platform,this.form.live_url=this.joinRecord.live_url):Object(l["i"])().then((function(e){var i=e.data.data;t.form.server=i.jx3_server,t.form.phone=i.user_phone||"",t.form.qq=i.qq_number})))},loadNotice:function(){var t=this;Object(q["b"])("lover-join").then((function(e){t.origin_notice=e}))}},mounted:function(){this.initJoinForm(),this.loadNotice()}},k=$,L=(i("821f"),Object(v["a"])(k,s,a,!1,null,null,null));e["default"]=L.exports},"821f":function(t,e,i){"use strict";i("8556")},8556:function(t,e,i){},9485:function(t,e,i){"use strict";var s=i("23e7"),a=i("2266"),o=i("59ed"),n=i("825a"),r=i("46c4"),l=i("2a62"),c=i("f99f"),u=i("2ba4"),d=i("d039"),m=TypeError,f=d((function(){[].keys().reduce((function(){}),void 0)})),v=!f&&c("reduce",m);s({target:"Iterator",proto:!0,real:!0,forced:f||v},{reduce:function(t){n(this);try{o(t)}catch(d){l(this,"throw",d)}var e=arguments.length<2,i=e?void 0:arguments[1];if(v)return u(v,this,e?[t]:[t,i]);var s=r(this),c=0;if(a(s,(function(s){e?(e=!1,i=s):i=t(i,s,c),c++}),{IS_RECORD:!0}),e)throw new m("Reduce of empty iterator with no initial value");return i}})},d58f:function(t,e,i){"use strict";var s=i("59ed"),a=i("7b0b"),o=i("44ad"),n=i("07fa"),r=TypeError,l="Reduce of empty array with no initial value",c=function(t){return function(e,i,c,u){var d=a(e),m=o(d),f=n(d);if(s(i),0===f&&c<2)throw new r(l);var v=t?f-1:0,p=t?-1:1;if(c<2)while(1){if(v in m){u=m[v],v+=p;break}if(v+=p,t?v<0:f<=v)throw new r(l)}for(;t?v>=0:f>v;v+=p)v in m&&(u=i(u,m[v],v,d));return u}};t.exports={left:c(!1),right:c(!0)}},f1d2:function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"a",(function(){return o})),i.d(e,"c",(function(){return n}));i("99af");var s=i("41cb");function a(t){return Object(s["e"])().post("/api/team/rank/join",t)}function o(t,e){return Object(s["e"])().get("/api/team/rank/my-records",{params:{event_id:t}})}function n(t,e,i){return Object(s["e"])().put("/api/team/pvp-event/".concat(t,"/my/join-record/item/").concat(e),i)}}}]);