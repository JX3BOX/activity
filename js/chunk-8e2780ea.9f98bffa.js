(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8e2780ea"],{2719:function(t,e,a){},"9caa":function(t,e,a){"use strict";a("2719")},a68d:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-lover-vote wp"},[e("div",{staticClass:"u-page-title"},[e("img",{staticClass:"u-img",attrs:{src:"".concat(t.__imgRoot,"vote-title.png?11")}})]),e("div",{staticClass:"m-line-box"},[e("div",{staticClass:"m-box"},[e("h2",[t._v("投票规则")]),e("div",{staticClass:"u-rule",domProps:{innerHTML:t._s(t.vote_note)}})])]),e("div",{staticClass:"m-vote-list"},t._l(t.list,(function(a,n){return e("div",{key:n,staticClass:"m-line-box"},[e("div",{staticClass:"m-box"},[e("div",{staticClass:"u-hot"},[t._v("人气值："+t._s(a.votes))]),e("el-image",{staticClass:"u-img",attrs:{src:a.images[0]}},[e("i",{attrs:{slot:"error"},slot:"error"})]),e("div",{staticClass:"u-team"},[t._v(t._s(a.team_name))]),e("div",{staticClass:"u-name"},t._l(t.uniqBy(a.teammeta_user_list,"id"),(function(a,n){return e("span",{key:n},[t._v(" "+t._s(a.display_name)+" ")])})),0),e("div",{staticClass:"u-slogan"},[t._v(t._s(a.slogan))]),e("div",{staticClass:"u-button",class:{"is-loading":t.vote_loading},on:{click:function(e){return t.onVote(a)}}})],1)])})),0),e("el-pagination",{staticClass:"m-pagination",attrs:{background:"",total:t.total,"hide-on-single-page":"",layout:"prev, pager, next","current-page":t.index,"page-size":t.pageSize},on:{"current-change":t.changePage}})],1)},s=[],i=a("c14f"),o=a("1da1"),r=(a("d3b7"),a("2ef0")),c=a("ead5"),u={name:"LoverVote",inject:["__imgRoot"],data:function(){return{pageSize:30,index:1,list:[],total:0,vote_loading:!1}},computed:{eventId:function(){return this.$store.getters.currentEventId},event:function(){return this.$store.state.event},vote_note:function(){return this.$store.state.event.vote_note},params:function(){return{pageSize:this.pageSize,index:this.index}}},watch:{params:{deep:!0,immediate:!0,handler:function(){this.load()}}},methods:{uniqBy:r["uniqBy"],load:function(){var t=this;Object(c["a"])(this.eventId).then((function(e){t.list=e.data.data.list||[],t.total=e.data.data.page.total}))},changePage:function(t){this.index=t},onVote:function(t){var e=this;return Object(o["a"])(Object(i["a"])().m((function a(){var n,s,o,r,u,l,d,v,g;return Object(i["a"])().w((function(a){while(1)switch(a.n){case 0:if(!e.vote_loading){a.n=1;break}return a.a(2);case 1:return e.vote_loading=!0,a.p=2,a.n=3,Object(c["j"])(e.eventId,t.id,{vote:1});case 3:if(o=a.v,r=null===(n=o.data)||void 0===n||null===(s=n.data)||void 0===s?void 0:s.id,!e.event.is_point_vote){a.n=10;break}if(r){a.n=4;break}return e.$message.error("投票失败，请稍后再试"),a.a(2);case 4:u=0;case 5:if(!(u<10)){a.n=9;break}return a.n=6,new Promise((function(t){return setTimeout(t,500)}));case 6:return a.n=7,Object(c["h"])(e.eventId,t.id,r);case 7:if(v=a.v,g=null===(l=v.data)||void 0===l||null===(d=l.data)||void 0===d?void 0:d.status,!g){a.n=8;break}return e.$message.success("投票成功"),t.votes+=1,a.a(3,9);case 8:u++,a.n=5;break;case 9:a.n=11;break;case 10:e.$message.success("投票成功"),t.votes+=1;case 11:return a.p=11,e.vote_loading=!1,a.f(11);case 12:return a.a(2)}}),a,null,[[2,,11,12]])})))()}}},l=u,d=(a("9caa"),a("2877")),v=Object(d["a"])(l,n,s,!1,null,null,null);e["default"]=v.exports}}]);