(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fb0337d2"],{6544:function(t,e,s){},"811b":function(t,e,s){"use strict";s("6544")},a68d:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t._self._c;return e("lover-layout",[e("div",{staticClass:"m-lover-vote wp"},[e("div",{staticClass:"u-page-title"},[e("img",{staticClass:"u-img",attrs:{src:"".concat(t.__imgRoot,"vote-title.png")}})]),e("div",{staticClass:"m-rule-box"},[e("h2",{staticClass:"u-rule-title"},[t._v("投票规则")]),e("div",{staticClass:"u-rule-icon"},[t._v("♡")]),e("div",{staticClass:"u-rule",domProps:{innerHTML:t._s(t.vote_note)}})]),e("div",{staticClass:"m-vote-list"},t._l(t.list,(function(s){return e("div",{key:s.id,staticClass:"m-vote-box",class:{"is-voted":s.voted},on:{mouseenter:function(e){return t.onMouseEnter(s.id)},mouseleave:function(e){return t.onMouseLeave(s.id)}}},[e("div",{staticClass:"m-team-box"},[e("el-image",{staticClass:"u-team-img",attrs:{src:s.images[0]}},[e("i",{attrs:{slot:"error"},slot:"error"})]),e("div",{staticClass:"m-team-info"},[e("div",{staticClass:"u-team"},[t._v(t._s(s.team_name))]),e("div",{staticClass:"u-teammates"},t._l(t.uniqBy(s.teammeta_user_list,"id"),(function(s,a){return e("div",{key:a,staticClass:"u-teammate"},[e("el-image",{staticClass:"u-avatar",attrs:{src:t.showAvatar(s.avatar)}}),t._v(t._s(s.display_name)+" ")],1)})),0)])],1),e("div",{staticClass:"m-slogan-box"},[t._v(" 参赛宣言： "),e("div",{staticClass:"u-slogan"},[t._v(t._s(s.slogan))])]),e("div",{staticClass:"m-action-box"},[e("div",{staticClass:"u-hot"},[e("i",{staticClass:"u-hot-icon"},[t._v(t._s(s.voted?"♥":"♡"))]),t._v(" 人气值："+t._s(s.votes)+" ")]),e("div",{staticClass:"u-button",class:{voted:s.voted,disabled:t.vote_loading||s.voted||t.disabled},on:{click:function(e){return t.onVote(s)}}},[e("span",{staticClass:"u-text"},[t._v(t._s(s.voted?"已投票":"投票"))])])])])})),0)])])},i=[],n=s("c14f"),o=s("1da1"),r=(s("4de4"),s("e9f5"),s("910d"),s("7d54"),s("a732"),s("d3b7"),s("159b"),s("2ef0")),c=s("ead5"),u=s("c9d2"),d=s("85e4"),v=(s("daef"),{name:"LoverVote",inject:["__imgRoot"],components:{},data:function(){return{pageSize:30,index:1,list:[],total:0,vote_loading:!1,loading:!1,disabled:!1}},computed:{eventId:function(){return this.$store.getters.currentEventId},event:function(){return this.$store.state.event},vote_note:function(){return this.$store.state.event.vote_note},params:function(){return{pageSize:this.pageSize,index:this.index}},uid:function(){return u["a"].getInfo().uid},isLogin:function(){return u["a"].isLogin()}},watch:{params:{deep:!0,immediate:!0,handler:function(){this.load()}}},methods:{uniqBy:r["uniqBy"],showAvatar:d["n"],load:function(){var t=this;this.loading=!0,Object(c["m"])(this.eventId).then((function(e){t.list=e.data.data.list||[],t.loading=!1,t.isLogin&&Object(c["j"])({user_id:t.uid,event_id:t.eventId}).then((function(e){var s=e.data.data.list||[];t.list.forEach((function(e){var a=s.some((function(t){return t.record_id===e.id}));t.$set(e,"voted",a)})),s.length>=(t.event.vote_limit||1)&&(t.disabled=!0)}))}))},onVote:function(t){var e=this;return Object(o["a"])(Object(n["a"])().m((function s(){var a,i,o,r,u,d,v,l,f,m;return Object(n["a"])().w((function(s){while(1)switch(s.p=s.n){case 0:if(!e.vote_loading){s.n=1;break}return s.a(2);case 1:return e.vote_loading=!0,s.p=2,o=e.event.is_point_vote?Object(c["r"])(e.eventId,t.id,{votes_count:10}):Object(c["r"])(e.eventId,t.id,{votes_count:0}),s.n=3,o;case 3:if(r=s.v,u=null===(a=r.data)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.id,!e.event.is_point_vote){s.n=10;break}if(u){s.n=4;break}return e.$message.error("投票失败，请稍后再试"),s.a(2);case 4:d=0;case 5:if(!(d<10)){s.n=9;break}return s.n=6,new Promise((function(t){return setTimeout(t,500)}));case 6:return s.n=7,Object(c["n"])(e.eventId,t.id,u);case 7:if(f=s.v,m=null===(v=f.data)||void 0===v||null===(l=v.data)||void 0===l?void 0:l.status,!m){s.n=8;break}return e.$message.success("投票成功"),t.votes+=1,t.voted=!0,s.a(3,9);case 8:d++,s.n=5;break;case 9:s.n=11;break;case 10:e.$message.success("投票成功"),t.votes+=1,t.voted=!0,e.list.filter((function(t){return t.voted})).length>=(e.event.vote_limit||1)&&(e.disabled=!0);case 11:return s.p=11,e.vote_loading=!1,s.f(11);case 12:return s.a(2)}}),s,null,[[2,,11,12]])})))()},onMouseEnter:function(t){var e=this.$refs["particle-".concat(t)];e&&e[0]&&e[0].playAnimation()},onMouseLeave:function(t){var e=this.$refs["particle-".concat(t)];e&&e[0]&&e[0].stopAnimation()}}}),l=v,f=(s("811b"),s("2877")),m=Object(f["a"])(l,a,i,!1,null,null,null);e["default"]=m.exports},a732:function(t,e,s){"use strict";var a=s("23e7"),i=s("c65b"),n=s("2266"),o=s("59ed"),r=s("825a"),c=s("46c4"),u=s("2a62"),d=s("f99f"),v=d("some",TypeError);a({target:"Iterator",proto:!0,real:!0,forced:v},{some:function(t){r(this);try{o(t)}catch(a){u(this,"throw",a)}if(v)return i(v,this,t);var e=c(this),s=0;return n(e,(function(e,a){if(t(e,s++))return a()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})}}]);