(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4e0713ce"],{"08b1":function(e,t,n){},9423:function(e,t,n){"use strict";n.r(t);n("b0c0");var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"p-lover-card",style:e.containerStyle},[t("div",{staticClass:"m-container"},[t("div",{staticClass:"m-top-section"},[t("div",{staticClass:"m-header"},[t("div",{staticClass:"m-title"},[t("img",{staticClass:"u-title-img",attrs:{src:"".concat(e.cdnLink,"design/event/lover/title.png"),alt:"title"}}),e._m(0)]),t("div",{staticClass:"m-cards-info"},[t("div",{staticClass:"u-title"},[e._v("天命签效果说明")]),t("div",{staticClass:"u-list"},e._l(e.cards,(function(n,a){return t("div",{key:a,staticClass:"u-list-item"},[t("span",{staticClass:"u-list-item-name"},[e._v(e._s(n.name))]),t("span",[e._v("-")]),t("span",{staticClass:"u-list-item-desc"},[e._v(e._s(n.desc))])])})),0)])]),t("div",{staticClass:"m-cards"},[t("video",{staticClass:"u-result-fire",attrs:{autoplay:"",disablepictureinpicture:"",disableremoteplayback:"",loop:"",muted:"",playsinline:"",src:"".concat(e.cdnLink,"design/event/lover/fire.webm")},domProps:{muted:!0}}),e._l(e.renderCards,(function(n,a){return t("div",{key:a,ref:"cardRef",refInFor:!0,staticClass:"u-card",style:e.cardStyle(a)},[t("div",{staticClass:"u-card-flipper",class:{"is-center":a===Math.floor(e.cards.length/2)}},[t("img",{staticClass:"u-card-cover",attrs:{src:n.img,alt:""}}),t("img",{staticClass:"u-card-back",attrs:{src:e.cardBackImg,alt:""}})])])}))],2)]),t("div",{staticClass:"m-actions-section"},[t("div",{staticClass:"m-select"},[t("el-select",{staticClass:"u-select u-select-event",attrs:{placeholder:"选择活动","popper-class":"m-card-select-popper",disabled:e.onDrawing||e.enableResultAnimation},on:{change:e.onSelectEvent},model:{value:e.slug,callback:function(t){e.slug=t},expression:"slug"}},e._l(e.$store.state.events,(function(e){return t("el-option",{key:e.slug,attrs:{label:e.name,value:e.slug}})})),1),t("el-select",{staticClass:"u-select u-select-process",attrs:{placeholder:"选择赛程","popper-class":"m-card-select-popper",disabled:e.onDrawing||e.enableResultAnimation},model:{value:e.currentProcessId,callback:function(t){e.currentProcessId=t},expression:"currentProcessId"}},e._l(e.processes,(function(e){return t("el-option",{key:e.id,attrs:{label:"第 ".concat(e.round," 轮"),value:e.id}})})),1),t("el-select",{staticClass:"u-select u-select-team",attrs:{placeholder:"选择队伍","popper-class":"m-card-select-popper",disabled:e.onDrawing||e.enableResultAnimation},model:{value:e.currentTeamId,callback:function(t){e.currentTeamId=t},expression:"currentTeamId"}},e._l(e.teamOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.team_name,value:e.id}})})),1)],1),t("div",{staticClass:"u-draw-button",on:{click:e.onDraw}}),t("div",{staticClass:"u-confirm-button",class:{"is-ready":e.currentCard},on:{click:e.onSetCard}},[e.currentCard?t("div",{staticClass:"u-draw-result"},[t("span",[e._v("本次抽得：")]),t("span",{staticClass:"u-draw-result-name"},[e._v(e._s(e.currentCard.name))])]):e._e(),e.currentCard?t("span",[e._v("提交结果")]):t("span",[e._v("未出结果")])])])])])},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"m-subtitle"},[t("div",{staticClass:"u-line"},[t("span",{staticClass:"u-line-title"},[e._v("裁判")]),t("span",{staticClass:"u-line-content"},[e._v("组织抽取“同心天命签”并公布结果")])]),t("div",{staticClass:"u-line"},[t("span",{staticClass:"u-line-title"},[e._v("选手")]),t("span",{staticClass:"u-line-content"},[e._v("根据抽签结果调整配装与奇穴，锁定配置")])])])}],s=n("ade3"),i=n("c14f"),c=n("1da1");function o(e){if(Array.isArray(e))return e}n("a4d3"),n("e01a"),n("d28b"),n("14d9"),n("d3b7"),n("3ca3"),n("ddb0");function l(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,s,i,c=[],o=!0,l=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;o=!1}else for(;!(o=(a=s.call(n)).done)&&(c.push(a.value),c.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{if(!o&&null!=n["return"]&&(i=n["return"](),Object(i)!==i))return}finally{if(l)throw r}}return c}}var u=n("06c5");n("d9e2");function d(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){return o(e)||l(e,t)||Object(u["a"])(e,t)||d()}var m=n("2909"),v=(n("4de4"),n("7db0"),n("c740"),n("a434"),n("e9f5"),n("f665"),n("65c2")),p=n("ead5"),h={name:"",components:{},props:{},data:function(){return{cdnLink:v["__cdn"],slug:null,cardBackImg:"".concat(v["__cdn"],"design/event/lover/q0.png"),cards:[],processes:[],currentProcessId:null,currentTeamId:null,currentCard:null,onDrawing:!1,animationPlaying:!1,enableFlipperAnimation:!0,cardRotateDeg:0,enableMoveAnimation:!1,cardMoveDistance:[],enableResultAnimation:!1}},computed:{events:function(){return this.$store.state.events},currentEvent:function(){return this.$store.state.event},containerStyle:function(){var e={"--background-image":"url(".concat(v["__cdn"],"design/event/lover/bg.webp)"),"--draw-image":"url(".concat(v["__cdn"],"design/event/lover/open0.png)"),"--draw-image-hover":"url(".concat(v["__cdn"],"design/event/lover/open1.png)")};return this.enableFlipperAnimation&&(e["--card-flipper-transition"]="transform 0.5s"),this.enableMoveAnimation&&(e["--card-move-transition"]="transform 0.5s"),this.enableResultAnimation&&(e["--card-flipper-transition"]="transform 0.5s",e["--card-center-transform"]="rotateY(180deg) scale(1.04)",e["--file-opacity"]=1),e["--card-transform"]="rotateY(".concat(this.cardRotateDeg,"deg)"),e},renderCards:function(){var e=this,t=Object(m["a"])(this.cards);if(this.currentCard){var n=t.findIndex((function(t){return t.id===e.currentCard.id}));if(-1!==n){var a=t.splice(n,1),r=f(a,1),s=r[0];t.splice(Math.floor(t.length/2),0,s)}}return t},currentProcess:function(){var e=this;return this.processes.find((function(t){return t.id===e.currentProcessId}))||null},teamOptions:function(){return this.currentProcess?[this.currentProcess.team1_record,this.currentProcess.team2_record].filter(Boolean):[]}},watch:{"$route.params.slug":{immediate:!0,handler:function(e){this.slug=e}},"currentEvent.id":{immediate:!0,deep:!0,handler:function(){this.loadCards(),this.loadProcessList()}}},methods:{onDraw:function(){var e=this;return Object(c["a"])(Object(i["a"])().m((function t(){var n,a,r;return Object(i["a"])().w((function(t){while(1)switch(t.n){case 0:if(!e.onDrawing&&!e.animationPlaying){t.n=1;break}return t.a(2);case 1:if(e.currentProcessId&&e.currentTeamId){t.n=2;break}return e.$message.error("请先选择赛程和队伍"),t.a(2);case 2:return e.onDrawing=!0,e.currentCard=null,t.n=3,Promise.all([e.loadDrawResult(),e.playAnimation()]);case 3:if(n=t.v,a=f(n,1),r=a[0],r){t.n=4;break}return t.a(2);case 4:e.currentCard=r,e.onDrawing=!1;case 5:return t.a(2)}}),t)})))()},playAnimation:function(){var e=this;return Object(c["a"])(Object(i["a"])().m((function t(){var n;return Object(i["a"])().w((function(t){while(1)switch(t.n){case 0:if(!e.animationPlaying){t.n=1;break}return t.a(2);case 1:return e.resetAnimation(),e.animationPlaying=!0,e.enableFlipperAnimation=!0,e.cardRotateDeg=180,t.n=2,new Promise((function(e){return setTimeout(e,1e3)}));case 2:return e.cardRotateDeg=360,t.n=3,new Promise((function(e){return setTimeout(e,1e3)}));case 3:e.enableFlipperAnimation=!1,e.cardRotateDeg=0,e.enableMoveAnimation=!0,n=0;case 4:if(!(n<4)){t.n=6;break}return e.doShuffle(),t.n=5,new Promise((function(e){return setTimeout(e,500)}));case 5:n++,t.n=4;break;case 6:e.enableMoveAnimation=!1,e.$set(e,"cardMoveDistance",[]),e.enableResultAnimation=!0,e.animationPlaying=!1;case 7:return t.a(2)}}),t)})))()},doShuffle:function(){if(this.cardMoveDistance.length)this.$set(this,"cardMoveDistance",[]);else for(var e=this.$refs.cardRef,t=0;t<e.length/2;t++){var n=e[t],a=e[e.length-1-t],r=a.offsetLeft-n.offsetLeft,s=n.offsetLeft-a.offsetLeft;this.$set(this.cardMoveDistance,t,r),this.$set(this.cardMoveDistance,e.length-1-t,s)}},resetAnimation:function(){this.enableFlipperAnimation=!1,this.enableMoveAnimation=!1,this.enableResultAnimation=!1,this.animationPlaying=!1,this.cardRotateDeg=0,this.$set(this,"cardMoveDistance",[])},cardStyle:function(e){return this.enableMoveAnimation?{transform:"translateX(".concat(this.cardMoveDistance[e]||0,"px)")}:this.enableResultAnimation&&e===Math.floor(this.cards.length/2)?{transform:"scale(1.2)",transition:"transform 0.5s"}:void 0},loadCards:function(){var e=this;Object(p["a"])({_no_page:1,event_id:this.currentEvent.id}).then((function(t){e.cards=t.data.data.list||[]}))},loadProcessList:function(){var e=this;Object(p["i"])({_no_page:1,event_id:this.currentEvent.id}).then((function(t){e.processes=t.data.data.list||[],console.log(Object(m["a"])(e.processes))})).catch((function(t){console.error("获取流程列表失败:",t),e.$message.error("获取流程列表失败，请稍后再试")}))},loadDrawResult:function(){var e=this;return Object(c["a"])(Object(i["a"])().m((function t(){return Object(i["a"])().w((function(t){while(1)switch(t.n){case 0:return t.a(2,Object(p["l"])(e.currentEvent.id,190).then((function(e){return e.data.data})).catch((function(t){console.error("抽签请求失败:",t),e.$message.error("抽签请求失败，请稍后再试")})))}}),t)})))()},onSelectEvent:function(e){e!=this.slug&&this.$router.push({name:"card",params:{slug:e}})},onSetCard:function(){var e=this;this.currentCard&&this.$confirm("是否将卡片 ".concat(this.currentCard.name," 设置为当前队伍的天命签？"),"确认").then((function(){var t=e.currentProcess.team1_record.id===e.currentTeamId?"team1_card":"team2_card";Object(p["m"])(e.currentProcessId,Object(s["a"])({},t,e.currentCard.id)).then((function(){e.$message.success("设置卡片成功"),e.loadProcessList()}))})).catch((function(){}))}}},b=h,g=(n("bd9b"),n("2877")),C=Object(g["a"])(b,a,r,!1,null,null,null);t["default"]=C.exports},bd9b:function(e,t,n){"use strict";n("08b1")},c740:function(e,t,n){"use strict";var a=n("23e7"),r=n("b727").findIndex,s=n("44d2"),i="findIndex",c=!0;i in[]&&Array(1)[i]((function(){c=!1})),a({target:"Array",proto:!0,forced:c},{findIndex:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),s(i)}}]);